<h2 mat-dialog-title>{{ data.heading }} Subscription Plan</h2>
<mat-dialog-content>
  <div class="form-container">
    <form [formGroup]="planForm" class="form-field-stack">

      <!-- Row 1: Subscription ID and Plan Name -->
      <div class="form-row" style="margin-top: 10px;">
        <mat-form-field appearance="outline" class="form-field-half" *ngIf="data?.row">
          <mat-label>Subscription ID</mat-label>
          <input matInput formControlName="subscriptionId" readonly />
        </mat-form-field>

        <mat-form-field appearance="outline" [class]="data?.row ? 'form-field-half' : 'form-field-full'">
          <mat-label>Plan Name</mat-label>
          <input matInput formControlName="planName" />
          <mat-error *ngIf="planForm.get('planName')?.invalid">Plan name is required</mat-error>
        </mat-form-field>
      </div>

      <!-- Row 2: Plan Type and Duration -->
      <div class="form-row">
       <mat-form-field appearance="outline" class="form-field-half">
  <mat-label>Plan Type</mat-label>
  <mat-select formControlName="planType" (selectionChange)="onPlanTypeChange($event.value)">
    <mat-option value="Monthly">Monthly</mat-option>
    <mat-option value="Quarterly">Quarterly</mat-option>
    <mat-option value="HalfYearly">Half-Yearly</mat-option>
    <mat-option value="Yearly">Yearly</mat-option>
  </mat-select>
  <mat-error *ngIf="planForm.get('planType')?.invalid">
    Plan type is required
  </mat-error>
</mat-form-field>


        <mat-form-field appearance="outline" class="form-field-half">
          <mat-label>Duration (Months)</mat-label>
          <input matInput type="number" formControlName="duration" min="1" readonly />
          <mat-error *ngIf="planForm.get('duration')?.invalid">Duration is required and must be at least 1</mat-error>
        </mat-form-field>
      </div>

      <!-- Row 3: Price and Status -->
      <div class="form-row">
        <mat-form-field appearance="outline" class="form-field-half">
          <mat-label>Price</mat-label>
          <input matInput type="number" formControlName="price" min="0" />
          <mat-error *ngIf="planForm.get('price')?.invalid">Price is required and must be at least 0</mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="form-field-half">
          <mat-label>Status</mat-label>
          <mat-select formControlName="status">
            <mat-option value="active">Active</mat-option>
            <mat-option value="inactive">InActive</mat-option>
            <mat-option value="cancelled">Cancelled</mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <!-- Row 5b: Active Toggle -->
      <div class="form-row">
        <div class="form-field-full">
          <mat-slide-toggle color="primary" formControlName="autoRenew">autoRenew</mat-slide-toggle>
        </div>
      </div>

      <!-- Row 6: Description -->
      <div class="form-row">
        <mat-form-field appearance="outline" class="form-field-full">
          <mat-label>Description</mat-label>
          <textarea matInput formControlName="description" rows="3"></textarea>
        </mat-form-field>
      </div>

      <!-- Row 7: Features -->
      <div class="form-row">
        <div class="form-field-full">
          <h4>Features</h4>
          <div formArrayName="features">
            <div *ngFor="let feature of features.controls; let i = index" class="feature-row">
              <mat-form-field appearance="outline" class="feature-input">
                <mat-label>Feature {{ i + 1 }}</mat-label>
                <input matInput [formControlName]="i" />
              </mat-form-field>
              <button mat-icon-button color="warn" (click)="removeFeature(i)" type="button" *ngIf="features.length > 0">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </div>
          <button mat-stroked-button color="primary" type="button" (click)="addFeature()" class="add-feature-btn">
            <mat-icon>add</mat-icon> Add Feature
          </button>
        </div>
      </div>

    </form>

    <!-- Spinner Overlay -->
    <div *ngIf="loading" class="loading-overlay">
      <mat-spinner color="accent" aria-label="Loading"></mat-spinner>
    </div>
  </div>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-raised-button mat-dialog-close class="cancel-button">
    Cancel
  </button>
  <button mat-raised-button class="save-button" (click)="savePlan()">
    {{ buttonLabel }}
  </button>
</mat-dialog-actions>
